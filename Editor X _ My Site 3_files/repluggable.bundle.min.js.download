!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("_"),require("React"),require("ReactRedux"),require("Redux")):"function"==typeof define&&define.amd?define("repluggable",["_","React","ReactRedux","Redux"],t):"object"==typeof exports?exports.repluggable=t(require("_"),require("React"),require("ReactRedux"),require("Redux")):e.repluggable=t(e._,e.React,e.ReactRedux,e.Redux)}("undefined"!=typeof self?self:this,(function(e,t,n,o){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="http://localhost:3201/",n(n.s=5)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t,n){"use strict";var o=n(3).compose;t.__esModule=!0,t.composeWithDevTools="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?o:o.apply(null,arguments)},t.devToolsEnhancer="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__:function(){return function(e){return e}}},function(e,t,n){"use strict";n.r(t),n.d(t,"AppHostAPI",(function(){return o})),n.d(t,"AppMainView",(function(){return te})),n.d(t,"ConsoleHostLogger",(function(){return O})),n.d(t,"createAppHost",(function(){return B})),n.d(t,"makeLazyEntryPoint",(function(){return T})),n.d(t,"mainViewSlotKey",(function(){return L})),n.d(t,"stateSlotKey",(function(){return z})),n.d(t,"SlotRenderer",(function(){return Y})),n.d(t,"ShellRenderer",(function(){return J})),n.d(t,"invokeSlotCallbacks",(function(){return S})),n.d(t,"connectWithShell",(function(){return se})),n.d(t,"observeWithShell",(function(){return ce})),n.d(t,"connectWithShellAndObserve",(function(){return le})),n.d(t,"ErrorBoundary",(function(){return V})),n.d(t,"interceptEntryPoints",(function(){return ue})),n.d(t,"interceptEntryPointsMap",(function(){return de})),n.d(t,"interceptAnyObject",(function(){return b})),n.d(t,"monitorAPI",(function(){return x})),n.d(t,"hot",(function(){return D}));const o={name:"AppHost API",public:!0};var r=n(0),s=n.n(r),i=n(1),a=n.n(i),c=n(2);const l=()=>!0;const u="$installedShells/update",d={getInstalledShellsSet:e=>(e=>e.$installedShells)(e).installedShells},h=e=>({type:u,updates:e}),p=(e={installedShells:{}},t)=>{return t.type===u?Object.assign(Object.assign({},e),{installedShells:(n=e.installedShells,o=t.updates,s.a.pickBy(s.a.assign({},n,o),s.a.identity))}):e;var n,o},f=e=>s.a.chain(e).invoke("getDependencyAPIs").defaultTo([]).value(),g=e=>s.a.chain(e).invoke("declareAPIs").defaultTo([]).value();var m=n(3),y=n(4);function b(e,t,n,o){return s.a.mapValues(e,((e,r)=>"function"==typeof e&&"function"==typeof t?t(r,e):o&&s.a.isObjectLike(e)?b(e,t?(e,n)=>t(`${r}.${e}`,n):void 0,n?(e,t)=>n(`${r}.${e}`,t):void 0,o-1):"function"==typeof n?n(r,e):e))}function S(e,...t){const n=e.getItems();e.host.options.monitoring.disableMonitoring?n.forEach((e=>{try{e.contribution(...t)}catch(e){console.error(e)}})):n.forEach((n=>{const o=`${e.host}-${e.name}:${n.shell.name}${n.name&&"-"+n.name}`;n.shell.log.monitor(o,{},(()=>n.contribution(...t)))}))}const v=(0,s.a.curry)(((e,t,n)=>{let o=null;return()=>(o||(o=e((()=>{o=null,n()}))),()=>{t(o||-1),o=null})})),E=(e,t,n,o)=>{function r(e,t,n){return b(e,((e,r)=>(e=>(r,s)=>{if(o&&r&&n&&s.__shellName&&n!==s.__shellName)return r;const i=e(r,s);return i!==r&&t(),i})(r)))}function i(){return e.getItems().reduce(((e,o)=>{const s=o.shell.name;return e[s]=Object.assign(Object.assign({},e[s]),function({notificationScope:e,reducerFactory:o,observable:s},i){const a=o();if("broadcasting"===e)return r(a,t,i);if(!s)throw new Error(`getPerShellReducersMapObject: notificationScope=observable but 'observable' is falsy, in shell '${i}'`);return r(a,(()=>n(s)))}(o.contribution,s)),e}),{})}const a=function(){const e=Object.assign({},{$installedShells:p});return Object.assign(Object.assign({},e),function(){const e=i();return s.a.mapValues(e,(e=>Object(m.combineReducers)(e)))}())}();return Object(m.combineReducers)(a)},w=(e,t,n,o,r,i)=>{let a,c=!1;const l=()=>{c=!0},u=e=>{a||(a=new Set),a.add(e)},d=()=>{c=!1,a=void 0},h=E(t,l,u,e.options.shouldScopeReducers),p=e.options.enableReduxDevtoolsExtension?Object(m.createStore)(h,Object(y.devToolsEnhancer)({name:"repluggable"})):Object(m.createStore)(h),f=e=>e();let g=[];const b=()=>{try{i(!0),a&&a.forEach((e=>{e.notify()})),r(!0),!c&&a||e.getAppHostServicesShell().log.monitor("ThrottledStore.notifySubscribers",{},(()=>s.a.forEach(g,f)))}finally{d(),r(!1),i(!1)}},S=v(n,o,b);let w=s.a.noop;p.subscribe((()=>{w=S()}));const P=e=>p.dispatch(e),O=Object.assign(Object.assign({},p),{subscribe:e=>(g=s.a.concat(g,e),()=>{g=s.a.without(g,e)}),syncSubscribe:p.subscribe,dispatch:P,dispatchWithShell:e=>t=>P(((e,t)=>Object.assign(Object.assign({},t),{__shellName:e.name}))(e,t)),flush:()=>{w(),b()},broadcastNotify:l,observableNotify:u,resetPendingNotifications:d,hasPendingSubscribers:()=>c});return d(),O},P={end(e,t,n){t&&console.error(t,n)}},O={spanRoot:(e,t,n)=>P,spanChild:(e,t,n)=>P,log(e,t,n,o){const r=function(e){switch(e){case"debug":return console.debug;case"event":return console.info;case"warning":return console.warn;case"error":case"critical":return console.error;default:return console.log}}(e);r(t,o)}};function A(e,t){const n=t.tags?Object.assign(Object.assign({},t.tags),{$ep:t.name}):{$ep:t.name},o=(t,n)=>e.log.spanChild(t,r(n));return{log(t,n,o){e.log.log(t,n,void 0,r(o))},debug(t,n){e.log.log("debug",t,void 0,r(n))},info(t,n){e.log.log("info",t,void 0,r(n))},warning(t,n){e.log.log("warning",t,void 0,r(n))},error(t,n,o){e.log.log("error",t,n,r(o))},critical(t,n,o){e.log.log("critical",t,n,r(o))},spanChild:o,spanRoot:(t,n)=>e.log.spanRoot(t,r(n)),monitor:function(e,t,n){const s=r(t),i=o(e,s);try{const e=n();return(a=e)&&"object"==typeof a&&"function"==typeof a.then?e.then((e=>(i.end(!0,void 0,Object.assign(Object.assign({},s),{returnValue:e})),e))).catch((e=>{throw i.end(!1,e,s),e})):(i.end(!0,void 0,Object.assign(Object.assign({},s),{returnValue:e})),e)}catch(e){throw i.end(!1,e,s),e}var a}};function r(e){return e?Object.assign(Object.assign({},e),n):n}}function I(e){return Array.isArray(e)}function x(e,t,n,o,r){if(t.monitoring.disableMonitoring||r&&!0===r.disableMonitoring)return o;const s=r&&I(r.disableMonitoring)?e=>{const{disableMonitoring:t}=r;if(I(t))return!t.find((t=>{const n=t;return 0===e.indexOf(n)&&(e.length===n.length||"."===e.charAt(n.length))}))}:()=>!0;return b(o,((t,r)=>{if(!s(t))return console.log("DISABLED MONITORING>",t),r;let i=!1;var a;return(a=r).hasOwnProperty("cache")&&a.hasOwnProperty("hit")&&(i=!0),(...s)=>{const a={$api:n,$apiFunc:t,$args:s,$memoized:i||void 0};return e.log.monitor(`${n}.${t}`,a,(()=>r.apply(o,s)))}}),void 0,r&&r.includesNamespaces?4:0)}class ${constructor(){this.map=new Map}addOrGetVertex(e){let t=this.map.get(e);return t||(t=new j(e),this.map.set(e,t)),t}getVertices(){return this.map.values()}addConnection(e,t){this.addOrGetVertex(e).connections.push(this.addOrGetVertex(t))}}class j{constructor(e){this.name=e,this.connections=[],this.index=-1,this.lowLink=-1}}function R(e){let t=Object.keys(e).map((e=>[e]));for(;t.length;){const n=[];for(const o of t){const t=e[o[0]]||[];for(const e of t){if(e===o[o.length-1])return[e,...o];n.push([e,...o])}}t=n}}class k{constructor(e){this.graph=e,this.index=0,this.stack=[],this.scc=[]}run(){for(const e of this.graph.getVertices())e.index<0&&this.strongConnect(e);return this.scc}strongConnect(e){e.index=this.index,e.lowLink=this.index,this.index=this.index+1,this.stack.push(e);for(const t of e.connections){const n=e;t.index<0?(this.strongConnect(t),n.lowLink=Math.min(n.lowLink,t.lowLink)):this.stack.some((e=>e.name===t.name))&&(n.lowLink=Math.min(n.lowLink,t.index))}if(e.lowLink===e.index){const t=[];let n=null;if(this.stack.length>0)do{n=this.stack.pop(),n&&t.push(n)}while(e.name!==(null==n?void 0:n.name));t.length>0&&this.scc.push(t)}}}function M(e,t,n){const o=()=>s.a.map(n,(e=>{const{calls:t,hit:n,miss:o}=e.func,r=`${(n/t*100).toFixed(2)}%`,{name:s}=e;return{name:s,hitRate:r,calls:t,hit:n,miss:o}})),r=e=>{const n=s.a.groupBy(t,"name")[e];try{const e=s.a.groupBy(n,(e=>JSON.stringify(e.args))),t=s.a.groupBy(n,(e=>JSON.stringify(e.res)));return{groupedArgs:e,groupedRes:t,groupedArgsAndRes:s.a.groupBy(n,(e=>JSON.stringify(e.args)+JSON.stringify(e.res)))}}catch(e){return{groupedArgs:[],groupedRes:[],groupedArgsAndRes:[]}}};return{getSortedMeasurments:()=>s()(t).map((e=>s.a.pick(e,["name","duration"]))).sortBy("duration").reverse().value(),start:()=>{e.monitoring.disableMonitoring?console.log('Remove "disableMonitoring" in order to use trace'):e.monitoring.enablePerformance=!0},stop:()=>{e.monitoring.enablePerformance=!1},clean:()=>{t.length=0},getTrace:()=>t,getGroupedTrace:()=>s.a.groupBy(t,"name"),getGroupedSumTrace:()=>{const e=s()(t).groupBy("name").mapValues(((e,t)=>{const n=Number(s.a.sumBy(e,"duration").toFixed(2)),o=e.length,i=Number((n/o).toFixed(2)),a=s()(r(t)).mapValues(((e,t)=>{const n=Object.keys(e);if(length=n.length,"groupedRes"!==t||0===length)return length;const o=n.join(" ");return o.length<15?`${length}: ${o}`:length})).value();return Object.assign({name:t,times:o,totalDuration:n,avgDuration:i},a)})).orderBy((e=>e.totalDuration),"desc").value();s.a.forEach(o(),(t=>{s.a.assign(s.a.find(e,{name:t.name}),t)})),console.table(e)},analyseAPI:e=>{const t=r(e);if(t){const{groupedArgs:e,groupedRes:n,groupedArgsAndRes:o}=t;console.log(`groupedArgs: ${Object.keys(e).length}`,e),console.log(`groupedRes: ${Object.keys(n).length}`,n),console.log(`groupedArgsAndRes: ${Object.keys(o).length}`,o)}},getMemoized:()=>n,printMemoizeTable:()=>{console.table(o())}}}var C=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};function D(e,t,n){if(!e.hot)return t;const o=()=>{var e;const t=null!=n?n:null===(e=window.repluggableAppDebug)||void 0===e?void 0:e.host;return t||console.error("HMR error: cannot find host object.\nhot(...) was called without the optional host parameter, and the fallback window.repluggableAppDebug.host doesn't exist"),t},r=t.map((e=>e.name)),s=e.id.split("/").pop();if(e.hot.accept(),e.hot.dispose((()=>C(this,void 0,void 0,(function*(){const e=o();e&&(console.debug(`----- HMR[${s}] > REMOVING SHELLS >`,r),yield e.removeShells(r))})))),"apply"===e.hot.status()){const e=o();e&&(console.debug(`----- HMR[${s}] > ADDING SHELLS >`,r),e.addShells(t))}return t}class _{static cleanup({set:e,ref:t}){e.delete(t)}constructor(e){if(this.weakMap=new WeakMap,this.refSet=new Set,this.finalizationGroup="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry(_.cleanup):null,e)for(const[t,n]of e)this.set(t,n)}set(e,t){var n;const o=(r=e,"undefined"!=typeof WeakRef?new WeakRef(r):r);var r;return this.weakMap.set(e,{value:t,ref:o}),this.refSet.add(o),null===(n=this.finalizationGroup)||void 0===n||n.register(e,{set:this.refSet,ref:o},o),this}get(e){const t=this.weakMap.get(e);return t&&t.value}delete(e){var t;const n=this.weakMap.get(e);return!!n&&(this.weakMap.delete(e),this.refSet.delete(n.ref),null===(t=this.finalizationGroup)||void 0===t||t.unregister(n.ref),!0)}get size(){return this.refSet.size}has(e){return this.weakMap.has(e)}clear(){for(const[e]of this)this.delete(e)}forEach(e,t){for(const[t,n]of this)e(n,t,this)}get[Symbol.toStringTag](){return"[object IterableWeakMap]"}*[Symbol.iterator](){for(const t of this.refSet){const n="object"==typeof(e=t)&&null!==e&&"deref"in e?t.deref():t;if(!n)continue;const o=this.weakMap.get(n);o&&(yield[n,o.value])}var e}entries(){return this[Symbol.iterator]()}*keys(){for(const[e]of this)yield e}*values(){for(const[e,t]of this)yield t}}function N(e){return function(e){return s.a.every(e,s.a.isArray)}(e)?e:[e]}const T=(e,t)=>({name:e,factory:t}),L={name:"mainView"},z={name:"state"},q=(e,t)=>e.reduce(((e,n)=>(e[n]=t,e)),{});function B(e,t={monitoring:{}}){let n=null,r=!1,i=!1,c=!1;const u=new Map;(e=>{if(!e)return;const t=s.a.flatten(e),n=s()(t).countBy((({name:e})=>e)).pickBy((e=>e>1)).keys().value();if(n.length>0)throw new Error(`Cannot initialize host with non unique layers: ${n}`)})(t.layers);const p=(()=>{let e=[];return{get:()=>e,set(t){e=t}}})(),m=s.a.map(t.layers?N(t.layers):[],((e,t)=>s.a.map(e,(e=>Object.assign(Object.assign({},e),{dimension:t}))))),y=new Set,b=new Set,v=new Map,P=new Map,I=new Map,j=new WeakMap,C=new Map,T=new Map,B=new WeakMap,F=new _;let V=!1;const W={getAllEntryPoints:()=>[...I.entries()].map((([,{entryPoint:e}])=>e)),getAppHostOptions:()=>t},H=function(e){let t=null;return{name:"APP-HOST-SERVICES",declareAPIs:()=>[o],attach(n){t=n,n.contributeAPI(o,e)},getAppHostServicesShell(){if(t)return t;throw new Error("Shell for AppHostServices entry point was not yet created")}}}((()=>W)),U={getStore:le,getAPI:ce,getSlot:ae,getAllSlotKeys:function(){return Array.from(v.keys())},getAllEntryPoints:function(){throw new Error("not implemented")},hasShell:function(e){return!0===d.getInstalledShellsSet(le().getState())[e]},isLazyEntryPoint:function(e){return C.has(e)},addShells:Y,removeShells:function(e){const t=ve();return Se(e),oe(s.a.difference(t,ve())),Promise.resolve()},onShellsChanged:function(e){const t=s.a.uniqueId("shells-changed-callback-");return T.set(t,e),t},removeShellsChangedCallback:function(e){T.delete(e)},getAppHostServicesShell:H.getAppHostServicesShell,log:t.logger?t.logger:O,options:t,executeWhenFree:function(e,t){r?u.set(e,t):t()}};!function({host:e,uniqueShellNames:t,readyAPIs:n,getAPI:o,getOwnSlotKey:r,getUnreadyEntryPoints:i,extensionSlots:a,addedShells:c,lazyShells:l,shellInstallers:u,performance:{options:d,trace:h,memoizedArr:p}}){const f={apis:()=>Array.from(n).map((e=>({key:e,impl:()=>o(e)}))),unReadyEntryPoints:()=>i(),whyEntryPointUnready:e=>{const t=s.a.find(f.unReadyEntryPoints(),(t=>t.name.toLowerCase()===e.toLowerCase())),o=s.a.invoke(t,"getDependencyAPIs"),i=s.a.filter(o,(e=>!n.has(r(e))));if(!s.a.isEmpty(i)){const t=s()(i).map("name").join(",");console.log(`There are unready dependencies for ${e}: ${t}`)}},findAPI:e=>s.a.filter(f.apis(),(t=>-1!==t.key.name.toLowerCase().indexOf(e.toLowerCase()))),performance:M(d,h,p)};window.repluggableAppDebug={host:e,uniqueShellNames:t,extensionSlots:a,addedShells:c,lazyShells:l,readyAPIs:n,shellInstallers:u,utils:f,hmr:{hot:D}}}({host:U,readyAPIs:y,uniqueShellNames:b,extensionSlots:v,addedShells:I,shellInstallers:j,lazyShells:C,performance:{options:t,trace:[],memoizedArr:[]},getUnreadyEntryPoints:p.get,getOwnSlotKey:de,getAPI:ce}),re(L),re(z),Y([H]);const G=(e,n)=>{if(t.monitoring.disableMemoization)return e;const o=s.a.memoize(e,n);if(t.monitoring.debugMemoization&&Object.defineProperty(o,"name",{value:`${e.name}_memoized`,writable:!1}),t.monitoring.disableMonitoring)return o;const r=function(e){const t=s.a.assign(e,{miss:0,calls:0,hit:0,printHitMiss:()=>console.log(`calls: ${t.calls}\nhit: ${t.hit}\nmiss: ${t.miss}\n`)}),n=t.cache.get.bind(e.cache);t.cache.get=e=>(t.calls++,t.hit++,n(e));const o=t.cache.set.bind(t.cache);return t.cache.set=(e,n)=>(t.calls++,t.miss++,o(e,n)),t}(o);return t.monitoring.debugMemoization?(...t)=>{const n=r(...t),o=e(...t);return s.a.isEqual(n,o)||(console.log("Memoization Error"),console.log("Memoization returns:",n),console.log("Original Func returns:",o),console.log("Original Func:",e)),n}:r};return Y(e),U;function K(e){return"function"==typeof e.factory}function X(e){const t=s()(m).flatten().find({name:e});if(!t)throw new Error(`Cannot find layer ${e}`);return t}function Q(e){if(!e.getDependencyAPIs||!e.layer||s.a.isEmpty(m))return;const t=s.a.chain(e.getDependencyAPIs()).flatMap((e=>e.layer?s()(e.layer).castArray().map((t=>({layer:X(t),apiKey:e}))).value():{apiKey:e})).groupBy((e=>{var t;return null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.dimension})).map((e=>s.a.maxBy(e,(e=>(null==e?void 0:e.layer)?e.layer.level:-1/0)))).value(),n=s()(e.layer).castArray().map((e=>X(e))).value();t.forEach((t=>{const o=(null==t?void 0:t.layer)&&(r=t.layer,n.find((e=>e.dimension===r.dimension)));var r;if((null==t?void 0:t.layer)&&o&&o.level<t.layer.level)throw new Error(`Entry point ${e.name} of layer ${o.name} cannot depend on API ${se(t.apiKey)} of layer ${t.layer.name}`)}))}function Y(e){U.log.log("debug",`Adding ${e.length} packages.`);const n=s.a.flatten(e),o=Object.values(I).map((e=>e.entryPoint)).concat(p.get(),n);t.disableLayersValidation||function(e){s.a.forEach(e,(e=>Q(e)))}(n),function(e){e.forEach((e=>function(e){if(b.has(e))throw new Error(`Shell named '${e}' already exists`);b.add(e)}(e.name)))}(n),!t.disableCheckCircularDependencies&&!t.experimentalCyclicMode&&function(e){const t=new Map;for(const n of e){const e=g(n);for(const o of e){const e=t.get(o.name);e?U.log.log("warning",`The API: ${o.name} is declared in multiple endpoints: ${e.name} and ${n.name}`):t.set(o.name,n)}}const n=new $;e.forEach((e=>{const t=g(e).map((e=>se(e))),o=f(e).map((e=>se(e)));t.forEach((e=>o.forEach((t=>n.addConnection(e,t)))))}));const o=new k(n).run();for(const t of o)if(t.length>1){const t={};e.forEach((e=>{const n=g(e).map((e=>e.name)),o=f(e).map((e=>e.name));n.forEach((e=>{t[e]=o}))}));const n=R(t);if(n)throw U.log.log("error",`Circular API dependency found: ${n.join(" -> ")}`),new Error("Circular API dependency found")}}(o);const[r,i]=s.a.partition(n,K);return ee(i),r.forEach(ue),ne(ve().concat(s.a.map(r,"name"))),Promise.resolve()}function Z(e,t,n=[]){const o=t.flatMap((e=>{var t;return((null===(t=e.declareAPIs)||void 0===t?void 0:t.call(e))||[]).map((t=>[t,e]))})),[,r]=o.find((([t,n])=>s.a.isEqual(t,e)))||[];if(!r)return!1;const i=r.getDependencyAPIs&&r.getDependencyAPIs(),a=s.a.differenceWith(i,n,s.a.isEqual);return s.a.every(a,(o=>y.has(de(o))||Z(o,t,n.concat(e))))}function ee(e){const[o,a]=s.a.partition(e,(n=>{const o=n.getDependencyAPIs&&n.getDependencyAPIs();return s.a.every(o,(n=>y.has(de(n))||t.experimentalCyclicMode&&Z(n,e)))}));if(p.set(s.a.union(s.a.difference(p.get(),o),a)),n&&s.a.isEmpty(o))return void function(){const e=u.values();try{for(const t of e)t()}finally{u.clear()}}();!function(e){r=!0;try{fe("getDependencyAPIs",e,(e=>e.entryPoint.getDependencyAPIs&&e.setDependencyAPIs(e.entryPoint.getDependencyAPIs())),(e=>!!e.entryPoint.getDependencyAPIs)),fe("attach",e,(e=>e.entryPoint.attach&&e.entryPoint.attach(e)),(e=>!!e.entryPoint.attach)),function(){const e=ae(z);n?((e,t,n)=>{const o=E(n,t.broadcastNotify,t.observableNotify,e.options.shouldScopeReducers);t.replaceReducer(o),t.resetPendingNotifications()})(U,n,e):(n=w(U,e,window.requestAnimationFrame,window.cancelAnimationFrame,(e=>{i=e}),(e=>{c=e})),n.subscribe((()=>{V&&(V=!1,he())})),n.syncSubscribe((()=>{V=!0,(i||c)&&(V=!1,he())})))}(),e.forEach((e=>e.setLifecycleState(!0,!0,!1))),fe("extend",e,(e=>e.entryPoint.extend&&e.entryPoint.extend(e)),(e=>!!e.entryPoint.extend)),e.forEach((e=>{I.set(e.entryPoint.name,e),e.setLifecycleState(!0,!0,!0)}))}finally{r=!1}ee(p.get())}(o.map(Ee))}function te(){T.forEach((e=>e(s.a.keys(d.getInstalledShellsSet(le().getState())))))}function ne(e){const t=q(e,!0);le().dispatch(h(t)),te()}function oe(e){const t=q(e,!1);le().dispatch(h(t)),te()}function re(e,t){const n=ie(e,(()=>function(e,t,n){let o=[],r=[];const i=s.a.uniqueId();return{host:t,declaringShell:n,name:e.name,contribute:function(e,n,a){o.push({shell:e,contribution:n,condition:a||l,uniqueId:s.a.uniqueId(`${e.name}_extItem_`)}),t.executeWhenFree(i,(()=>r.forEach((e=>e()))))},getItems:function(e=!1){return e?o:o.filter((e=>e.condition()))},getSingleItem:function(){return o.find((e=>e.condition()))},getItemByName:function(e){return o.find((t=>t.name===e&&t.condition()))},discardBy:function(e){const t=o.length;o=o.filter((t=>!e(t))),o.length!==t&&r.forEach((e=>e()))},subscribe:function(e){return r.push(e),()=>{r=r.filter((t=>t!==e))}}}}(e,U,t)));return n}function se(e){return void 0===e.version?e.name:`${e.name}(v${e.version})`}function ie(e,t){const n=se(e);if(!v.has(e)&&!P.has(n)){const o=t();return v.set(e,o),P.set(n,e),o}throw new Error(`Extension slot with key '${n}' already exists.`)}function ae(e){const t=de(e),n=v.get(t);if(n)return n;throw new Error(`Extension slot with key '${se(e)}' doesn't exist.`)}function ce(e){const t=ae(e).getSingleItem();if(t)return t.contribution;throw new Error(`API '${se(e)}' doesn't exist.`)}function le(){if(n)return n;throw new Error("Store was not yet created")}function ue(e){C.set(e.name,e.factory)}function de(e){if(!0===e.public){const t=P.get(se(e));if(t&&t.public)return t}return e}function he(){F.forEach((({f:e,shouldClear:t})=>{(t||s.a.stubTrue)()&&pe(e)}))}function pe(e){e.cache&&e.cache.clear&&e.cache.clear()}function fe(e,t,n,o){U.log.log("debug",`--- ${e} phase ---`);try{t.filter((e=>!o||o(e))).forEach((t=>function(e,t,n){U.log.log("debug",`${n} : ${e.entryPoint.name}`);try{t(e)}catch(t){throw U.log.log("error","AppHost.shellFailed",t,{shell:e.name,phase:n,message:`Shell '${e.name}' FAILED ${n} phase`,error:t}),t}}(t,n,e)))}catch(t){throw console.error(`${e} phase FAILED`,t),t}U.log.log("debug",`--- End of ${e} phase ---`)}function ge(e){const t=de(e);return v.has(t)?s.a.get(ae(t).getSingleItem(),"shell"):void 0}function me(e){const t=de(e);y.delete(t),v.delete(t),P.delete(se(t)),U.log.log("debug",`-- Removed slot keys: ${se(t)} --`)}function ye(e){const t=new Map,n=e=>s()([...I.entries()]).flatMap((([o,r])=>{var s,i;const a=t.get(o);if(a)return a;const c=((null===(i=null===(s=r.entryPoint)||void 0===s?void 0:s.getDependencyAPIs)||void 0===i?void 0:i.call(s))||[]).some((t=>{var n;return(null===(n=ge(t))||void 0===n?void 0:n.name)===e.name}));if(!c)return[];const l=[r,...n(r)];return t.set(o,l),l})).uniqBy("name").value();return n(e)}function be(e,t){fe("detach",e,(e=>s.a.invoke(e.entryPoint,"detach",e)));const n=e.map((({name:e})=>e)),o=(r=n,[...y].filter((e=>s.a.includes(r,s.a.get(ge(e),"name"))))).concat(function(e){const t=new Set(e),n=[];for(const e of v.entries()){const{declaringShell:o}=e[1];o&&t.has(o.name)&&n.push(e[0])}return n}(n));var r;v.forEach((e=>e.discardBy((e=>function(e,t){return s.a.includes(t,e.shell.name)||s.a.some(s.a.invoke(e.shell.entryPoint,"getDependencyAPIs"),(e=>s.a.includes(t,s.a.get(ge(e),"name"))))}(e,n))))),n.forEach((e=>{var n;if(!t.includes(e)){const t=null===(n=I.get(e))||void 0===n?void 0:n.entryPoint;t&&p.get().push(t)}I.delete(e),b.delete(e)})),o.forEach(me),U.log.log("debug",`Done uninstalling ${n}`)}function Se(e){U.log.log("debug",`-- Uninstalling ${e} --`);let t=s()(e).map((e=>I.get(e))).compact().flatMap((e=>[e,...ye(e)])).uniqBy("name").value();for(;!s.a.isEmpty(t);){const n=t.filter((e=>{return n=e,!t.find((e=>{var t,o;return((null===(o=null===(t=e.entryPoint)||void 0===t?void 0:t.getDependencyAPIs)||void 0===o?void 0:o.call(t))||[]).find((e=>{var t;return(null===(t=ge(e))||void 0===t?void 0:t.name)===n.name}))}));var n}));if(s.a.isEmpty(n))throw new Error(`Some shells could not detach: ${t.map((({name:e})=>e)).join()}`);be(n,e),t=s.a.differenceBy(t,n,"name")}}function ve(){return[...I].map((([e])=>e))}function Ee(e){let n=!1,o=!1,c=!1,l=new Set,u=1;const d=[];const h={name:e.name,entryPoint:e,getSlot(e){const t=U.getSlot(e),{declaringShell:n}=t;if(!n||n!==h)throw new Error(`Shell '${h.name}' is trying to get slot '${se(e)}' that is owned by '${n?n.name:"Host"}'`);return t},getAllSlotKeys:U.getAllSlotKeys,getAllEntryPoints:U.getAllEntryPoints,hasShell:U.hasShell,isLazyEntryPoint:U.isLazyEntryPoint,onShellsChanged:U.onShellsChanged,removeShellsChangedCallback:U.removeShellsChangedCallback,declareSlot:e=>re(e,h),declareCustomSlot:(e,t)=>function(e,t,n){const o=ie(e,(()=>function(e,t,n,o){return{name:e.name,host:n,declaringShell:o,contribute:(...e)=>t.contribute(...e),discardBy:(...e)=>t.discardBy(...e)}}(e,t,U,n)));return o}(e,t,h),setLifecycleState(e,t,r){n=e,o=t,c=r},setDependencyAPIs(e){l=new Set(e)},canUseAPIs:()=>o,canUseStore:()=>n,wasInitializationCompleted:()=>c,runLateInitializer(e){const t=c;try{return c=!1,e()}finally{c=t}},addShells(e){const t=s.a.flatten(e).map((e=>e.name)),n=j.get(h)||[];return j.set(h,[...n,...t]),U.addShells(e)},removeShells(t){const n=j.get(h)||[],o=s.a.difference(t,n);if(!s.a.isEmpty(o))throw new Error(`Shell ${e.name} is trying to uninstall shells: ${t} which is are not installed by entry point ${e.name} - This is not allowed`);return j.set(h,s.a.without(n,...t)),U.removeShells(t)},getAPI(t){if(l.has(t)||function(e){return ge(e)===h}(t))return U.getAPI(t);throw new Error(`API '${se(t)}' is not declared as dependency by entry point '${e.name}' (forgot to return it from getDependencyAPIs?)`)},contributeAPI(n,o,i){if(U.log.log("debug",`Contributing API ${se(n)}.`),!s.a.includes(s.a.invoke(e,"declareAPIs")||[],n))throw new Error(`Entry point '${e.name}' is trying to contribute API '${se(n)}' which it didn't declare`);if(!t.disableLayersValidation&&(e.layer||n.layer)&&(a=e.layer,c=n.layer,!s.a.isEqual(s()(a).castArray().sort().value(),s()(c).castArray().sort().value())))throw new Error(`Cannot contribute API ${se(n)} of layer ${n.layer||"<BLANK>"} from entry point ${e.name} of layer ${e.layer||"<BLANK>"}`);var a,c;const l=o(),u=x(h,t,(d=se(n)).charAt(0).toLowerCase()+d.substring(1).replace(new RegExp(" ","g"),""),l,i);var d;const f=re(n);if(B.set(n,!t.disableLayersValidation&&e.layer?s()(e.layer).castArray().map((e=>X(e))).value():void 0),f.contribute(h,u),y.add(n),!r){const e=s.a.map(p.get(),"name");ee(p.get()),ne(s.a.difference(e,s.a.map(p.get(),"name")))}return u},contributeState(e){const t={notificationScope:"broadcasting",reducerFactory:e};ae(z).contribute(h,t)},contributeObservableState(t,n){const o=`${e.name}/observable_${u++}`,r=((e,t,n)=>{const o={name:t},r=e.declareSlot(o);let s;const i=()=>{if(s)return s;const t=n(e.getStore().getState());return s=t,t};return{subscribe:(e,t)=>(r.contribute(e,t),()=>{r.discardBy((e=>e.contribution===t))}),notify(){s=void 0;const e=i();S(r,e)},current:i}})(h,o,n);r.subscribe(h,(()=>{he()}));const s={subscribe:r.subscribe,current:e=>{if(i&&!e)throw new Error(`Observer created by ${h.name} current() function: Should not read observable value during subscribers notify. If you wish to read the value, you component should be observing the value directly (using observeWithShell or connectWithShellAndObserve)`);return r.current()},notify:r.notify},a={notificationScope:"observable",reducerFactory:t,observable:r};return ae(z).contribute(h,a),s},getStore:()=>({dispatch:U.getStore().dispatchWithShell(h),subscribe:U.getStore().subscribe,getState:()=>U.getStore().getState()[h.name],flush:U.getStore().flush,hasPendingSubscribers:U.getStore().hasPendingSubscribers}),contributeMainView(e,t){ae(L).contribute(e,t)},contributeBoundaryAspect(e){d.push(e)},memoizeForState(e,t,n){const o=G(e,t);return F.set(o,n?{f:o,shouldClear:n}:{f:o}),o},flushMemoizedForState:he,memoize:(e,t)=>G(e,t),clearCache:pe,getBoundaryAspects:()=>d,getHostOptions:()=>U.options,log:A(U,e),wrapWithShellRenderer:e=>a.a.createElement(J,{shell:h,component:e,host:U})};return h}}function F(e){return e.getHostOptions()}class V extends a.a.Component{static getDerivedStateFromError(e){return{hasError:!0,errorMessage:e.message}}constructor(e){super(e),this.throttledResetError=s.a.throttle((()=>{this.resetError()}),500,{leading:!0}),this.state={hasError:!1,errorMessage:null}}componentDidCatch(e,t){const{shell:n,componentName:o}=this.props,{enableStickyErrorBoundaries:r}=F(n);n.log.error("ErrorBoundary.componentDidCatch",e,{componentName:o}),r||this.attemptToRecoverOnNextState()}render(){if(this.state.hasError){const{shell:n}=this.props,{enableStickyErrorBoundaries:o}=F(n),r=(e=n.name,(t=this.props.componentName)?`${e} / ${t}`:e);return o?a.a.createElement("div",{className:`component-error ${this.props.errorClassName||""}`,style:{pointerEvents:"all"},title:this.state.errorMessage||"(unknown error)"},"error in ",a.a.createElement("b",null,r),a.a.createElement("button",{onClick:()=>this.resetError()},"reset")):null}var e,t;return this.props.children||null}componentWillUnmount(){this.cancelAttemptToRecover()}resetError(){this.cancelAttemptToRecover(),this.setState({hasError:!1,errorMessage:null,unsubscribe:void 0})}attemptToRecoverOnNextState(){const{shell:e}=this.props;if(!this.state||!this.state.unsubscribe){const t=e.getStore().subscribe((()=>{this.throttledResetError()}));this.setState({unsubscribe:t})}}cancelAttemptToRecover(){this.state&&this.state.unsubscribe&&this.state.unsubscribe()}}const W=Object(i.createContext)(null),H=(e,t)=>s.a.isEqualWith(e,t,((t,n,o,r)=>Object(i.isValidElement)(t)?!!Object(i.isValidElement)(n)&&(t===n||t.key===n.key&&t.type===n.type&&H(t.props,n.props)):"children"===o&&r===e?("function"!=typeof t||"function"!=typeof n)&&void 0:"function"==typeof t&&"function"==typeof n||void 0)),U=Object(i.createContext)(null),G={context:U,areStatePropsEqual:H,areOwnPropsEqual:H};function K(e,t,n){const o=e.getBoundaryAspects();if(o&&o.length>n){const r=o[n];return a.a.createElement(r,null,K(e,t,n+1))}return t}const X=e=>e.host?a.a.createElement(c.Provider,{store:e.host.getStore(),context:U},e.children):a.a.createElement(a.a.Fragment,null,e.children),J=({shell:e,component:t,name:n,host:o})=>a.a.createElement(V,{shell:e,componentName:n},a.a.createElement(X,{host:o},a.a.createElement(W.Provider,{value:e},K(e,t,0))));const Q=Object(c.connect)(((e,{slot:t})=>({items:t.getItems()})),void 0,void 0,{context:U})((({items:e,mapFunc:t,filterFunc:n,sortFunc:o})=>a.a.createElement(a.a.Fragment,null,s.a.flow(s.a.compact([n&&(e=>e.filter(((e,t)=>n(e.contribution,t)))),o&&(e=>e.sort(o)),e=>e.map(function(e){return(t,n)=>a.a.createElement(J,{shell:t.shell,component:a.a.createElement(Z,{index:n,item:t,mapFunc:e}),key:t.uniqueId,name:t.name})}(t))]))(e))));function Y(e){const[t,n]=Object(i.useState)(0);return Object(i.useEffect)((()=>e.slot.subscribe((()=>n((e=>(e+1)%100))))),[]),a.a.createElement(Q,Object.assign({},e,{renderCount:t}))}const Z=Object(c.connect)(((e,t)=>({index:t.index,render:t.mapFunc?t.mapFunc(t.item.contribution,t.index):t.item.contribution,children:t.children,predicateResult:t.item.condition()})),void 0,void 0,G)((e=>a.a.createElement(a.a.Fragment,null,e.predicateResult?e.children||e.render():null))),ee=Object(c.connect)(((e,t)=>({installedShells:d.getInstalledShellsSet(e),host:t.host})),void 0,void 0,{context:U})((e=>{const t=e.host.getAppHostServicesShell();return a.a.createElement(W.Provider,{value:t},a.a.createElement(Y,{slot:e.host.getSlot(L),mapFunc:s.a.identity}))})),te=e=>a.a.createElement(c.Provider,{store:e.host.getStore(),context:U},a.a.createElement(ee,{host:e.host})),ne={context:U,areStatePropsEqual:H,areOwnPropsEqual:H};function oe(e,t,n,o){return(...r)=>!(!e||e(o,n()))||t(r[0],r[1])}function re(e,t,n,o,r={}){class i extends a.a.Component{constructor(i){super(i),this.getOwnProps=()=>s.a.omit(this.props,"shell"),this.mapStateToProps=t?(e,n)=>this.props.shell.log.monitor(`connectWithShell.mapStateToProps ${this.props.shell.name}`,{},(()=>t(this.props.shell,this.props.shell.getStore().getState(),n))):s.a.stubObject,this.mapDispatchToProps=n?(e,t)=>this.props.shell.log.monitor(`connectWithShell.mapDispatchToProps ${this.props.shell.name}`,{},(()=>n(this.props.shell,e,t))):s.a.stubObject;const a=r.shouldComponentUpdate&&this.props.shell.memoizeForState(r.shouldComponentUpdate,(()=>"*"));this.connectedComponent=Object(c.connect)((e=>{let t=null;return(...n)=>(t&&a&&!a(this.props.shell,this.getOwnProps())||(t=e(...n)),t)})(this.mapStateToProps),this.mapDispatchToProps,void 0,r.shouldComponentUpdate?Object.assign(Object.assign({},ne),{areStatePropsEqual:oe(a,ne.areStatePropsEqual,this.getOwnProps,o),areOwnPropsEqual:oe(a,ne.areOwnPropsEqual,this.getOwnProps,o)}):ne)(e)}render(){const e=this.connectedComponent,t=this.getOwnProps();return a.a.createElement(e,Object.assign({},t))}}return e=>a.a.createElement(W.Consumer,null,(t=>a.a.createElement(V,{shell:o,componentName:r.componentName},a.a.createElement(i,Object.assign({},((e,t)=>e.children?Object.assign(Object.assign({},e),{children:a.a.createElement(W.Provider,{value:t},e.children)}):e)(e,t),{shell:o})))))}function se(e,t,n,o={}){return r=>{(e=>{if(n.wasInitializationCompleted()&&!o.allowOutOfEntryPoint){const t=e.displayName||e.name||e,o=`connectWithShell(${n.name})(${t}): attempt to create component type outside of Entry Point lifecycle. To fix this, call connectWithShell() from Entry Point attach() or extend(). `;throw new Error(o)}})(r);const s=re(r,e,t,n,o);return o.renderOutsideProvider?function(e,t){return n=>e.wrapWithShellRenderer(t(n))}(n,s):s}}function ie(e,t){return s.a.mapValues(e,(e=>e.current(t)))}function ae(e,t,n,o){return r=>{const s=o?o(r):r;class i extends a.a.Component{constructor(o){super(o),this.unsubscribes=[],this.state=Object.assign(Object.assign({},ie(e,!0)),{rendersCounter:0}),this.staticShellProps=n?n(t,o):{}}componentDidMount(){for(const n in e){const o=e[n].subscribe(t,(()=>{const t=ie(e,!0);this.setState((e=>Object.assign(Object.assign({},t),{rendersCounter:(e.rendersCounter+1)%1e3})))}));this.unsubscribes.push(o)}}componentWillUnmount(){this.unsubscribes.forEach((e=>e())),this.unsubscribes=[]}render(){const e=Object.assign(Object.assign(Object.assign({},this.props),this.state),this.staticShellProps);return a.a.createElement(s,Object.assign({},e))}}return t=>a.a.createElement(i,Object.assign({},t,ie(e,!0)))}}function ce(e,t,n){return ae(e,t,n)}function le(e,t,n,o,r={}){const s=se(t,n,o,r),i=function(e,t){return n=>ae(e,t,void 0,n)}(e,o)(s);return i}function ue(e,t){return s.a.flatten([e]).map((e=>function(e,t){return{name:t.interceptName?t.interceptName(e.name):e.name,layer:e.layer,tags:t.interceptTags?t.interceptTags(e.tags):e.tags,getDependencyAPIs:t.interceptGetDependencyAPIs?t.interceptGetDependencyAPIs(e.getDependencyAPIs):e.getDependencyAPIs,declareAPIs:t.interceptDeclareAPIs?t.interceptDeclareAPIs(e.declareAPIs):e.declareAPIs,attach:t.interceptAttach?t.interceptAttach(e.attach):e.attach,detach:t.interceptDetach?t.interceptDetach(e.detach):e.detach,extend:t.interceptExtend?t.interceptExtend(e.extend):e.extend}}(e,t)))}function de(e,t){return s.a.mapValues(e,(e=>ue(e,t)))}}])}));